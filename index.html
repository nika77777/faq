<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ответы на вопросы — Энергетический Тэттринг</title>

  <style>
    :root{
      --base: 17px;
      --h1: 32px;
      --h2: 28px;
      --w700: 700;

      --navy-1:#071a33;
      --navy-2:#0b2a52;
      --gold:#b68b2a;

      --text:#0b1220;
      --muted:#5b6778;

      --bg:#ffffff;
      --surface:#ffffff;
      --surface-2:#f7f7f8;
      --border: rgba(16, 24, 40, 0.12);
      --shadow: 0 12px 28px rgba(2, 6, 23, 0.12);

      --r-lg: 18px;
      --r-md: 14px;

      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }

    body{
      margin:0;
      font-family: var(--font);
      font-size: var(--base);
      color: var(--text);
      background: var(--bg);
      line-height: 1.65;
    }

    .hero{
      background: linear-gradient(180deg, var(--navy-1), var(--navy-2));
      color:#fff;
      padding: 34px 16px 22px;
    }

    .wrap{
      max-width: 1020px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .hero h1{
      margin:0;
      font-size: var(--h1);
      font-weight: var(--w700);
    }

    .hero p{
      margin: 12px 0 0;
      max-width: 900px;
      color: rgba(255,255,255,0.88);
    }

    .content{
      padding: 24px 16px 60px;
    }

    /* --- Разделы-карточки --- */

    .tabs{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 18px;
    }

    @media (max-width: 720px){
      .tabs{ grid-template-columns: 1fr; }
    }

    .tab{
      border: 1px solid rgba(182,139,42,0.5);
      background: #fff;
      padding: 14px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 15px;
      font-weight: var(--w700);
      text-align: left;
      transition: 0.15s ease;
    }

    .tab:hover{
      background: rgba(182,139,42,0.06);
    }

    .tab[aria-selected="true"]{
      background: var(--gold);
      color:#fff;
      border-color: var(--gold);
    }

    .panel{
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      background: var(--surface);
      box-shadow: var(--shadow);
    }

    .panel-head{
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .panel-title{
      margin:0;
      font-size: var(--h2);
      font-weight: var(--w700);
    }

    .panel-sub{
      margin:10px 0 0;
      color: var(--muted);
    }

    .block{
      padding: 20px;
    }

    details.qa{
      margin-bottom: 12px;
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      background: #fff;
    }

    details.qa summary{
      list-style:none;
      cursor:pointer;
      padding:14px;
      font-size:18px;
      font-weight: var(--w700);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    details.qa summary::-webkit-details-marker{ display:none; }

    .qa-body{
      border-top:1px solid var(--border);
      padding:18px 20px;
    }

    .answer{
      max-width:760px;
      line-height:1.72;
    }

    .answer p{
      margin:0 0 16px;
    }

    .answer ul{
      margin:12px 0 16px 22px;
    }

    /* --- Подробнее --- */

    .more-wrap{
      margin-top:14px;
      border:1px dashed rgba(182,139,42,0.55);
      border-radius:14px;
      background:rgba(182,139,42,0.06);
    }

    details.more summary{
      padding:10px 12px;
      cursor:pointer;
    }

    details.more summary::-webkit-details-marker{ display:none; }

    details.more summary::before{
      content:"Подробнее";
      background:var(--gold);
      color:#fff;
      padding:6px 12px;
      border-radius:10px;
      font-weight:600;
    }

    .more-body{
      padding:0 16px 16px;
      max-width:760px;
      line-height:1.72;
    }

    /* --- Второй уровень --- */

    .level2-block{
      margin-top:22px;
      padding:18px;
      border-radius:16px;
      background: rgba(74,108,255,0.07);
      border:1px solid rgba(74,108,255,0.25);
    }

    .level2-block h4{
      margin:0 0 14px;
      font-size:15px;
      font-weight:var(--w700);
    }

    .hidden{ display:none; }

  </style>
</head>

<body>

<header class="hero">
  <div class="wrap">
    <h1>Ответы на вопросы</h1>
    <p>Выберите раздел. Сначала открываются вопросы первого уровня. Углубляющие вопросы станут доступны после раскрытия любого «Подробнее».</p>
  </div>
</header>

<main class="content">
  <div class="wrap">

    <div class="tabs" id="tabs"></div>

    <section class="panel">
      <div class="panel-head">
        <h2 class="panel-title" id="panelTitle">Выберите раздел</h2>
        <p class="panel-sub" id="panelSub"></p>
      </div>

      <div class="block">
        <div id="level1List"></div>

        <div id="level2Block" class="level2-block hidden">
          <h4>Углубляющие вопросы раздела</h4>
          <div id="level2List"></div>
        </div>
      </div>
    </section>

  </div>
</main>

<script type="module">
import { FAQ } from "./faq-data.js";

const SECTIONS = [
  "Что это за система и можно ли ей доверять",
  "Безопасность, границы и когда становится хуже",
  "Как это устроено на практике",
  "Что это даёт и чего не стоит ожидать",
  "Необычный опыт, инсайты и рациональный взгляд",
  "Для профессионалов и тех, кто уже многое пробовал"
];

const panelTitle = document.getElementById("panelTitle");
const panelSub = document.getElementById("panelSub");
const tabs = document.getElementById("tabs");
const level1List = document.getElementById("level1List");
const level2Block = document.getElementById("level2Block");
const level2List = document.getElementById("level2List");

let level2Unlocked = false;

function parseQno(source_hint){
  const m = String(source_hint || "").match(/вопрос:\s*(\d+)/i);
  return m ? Number(m[1]) : null;
}

function groupFor(category, qno){
  const ranges = {
    "Что это за система и можно ли ей доверять":[9,13],
    "Безопасность, границы и когда становится хуже":[10,14],
    "Как это устроено на практике":[8,11],
    "Что это даёт и чего не стоит ожидать":[9,13],
    "Необычный опыт, инсайты и рациональный взгляд":[8,12],
    "Для профессионалов и тех, кто уже многое пробовал":[12,16]
  };
  if(!ranges[category]) return "L1";
  const [a,b]=ranges[category];
  if(qno>=a && qno<=b) return "L2";
  return "L1";
}

function cleanText(t){
  return String(t||"").trim();
}

function renderAnswer(container, text){
  container.innerHTML="";
  const cleaned = cleanText(text);
  const blocks = cleaned.split(/\n\s*\n/);
  blocks.forEach(block=>{
    const p=document.createElement("p");
    p.textContent=block.trim();
    container.appendChild(p);
  });
}

function makeQA(item, isLevel2=false){
  const d=document.createElement("details");
  d.className="qa";

  const s=document.createElement("summary");
  s.textContent=item.question;
  d.appendChild(s);

  const body=document.createElement("div");
  body.className="qa-body";

  const ans=document.createElement("div");
  ans.className="answer";
  renderAnswer(ans,item.answer_main);
  body.appendChild(ans);

  if(item.answer_more && !isLevel2){
    const moreWrap=document.createElement("div");
    moreWrap.className="more-wrap";

    const more=document.createElement("details");
    more.className="more";

    const ms=document.createElement("summary");
    more.appendChild(ms);

    const mb=document.createElement("div");
    mb.className="more-body";
    renderAnswer(mb,item.answer_more);
    more.appendChild(mb);

    moreWrap.appendChild(more);
    body.appendChild(moreWrap);

    more.addEventListener("toggle",()=>{
      if(more.open && !level2Unlocked){
        level2Unlocked=true;
        level2Block.classList.remove("hidden");
      }
    });
  }

  d.appendChild(body);
  return d;
}

function renderSection(section){
  level2Unlocked=false;
  level2Block.classList.add("hidden");
  level1List.innerHTML="";
  level2List.innerHTML="";

  panelTitle.textContent=section;

  const data=FAQ.filter(x=>x.category===section)
    .map(x=>({...x,qno:parseQno(x.source_hint)}));

  const l1=data.filter(x=>groupFor(section,x.qno)==="L1");
  const l2=data.filter(x=>groupFor(section,x.qno)==="L2");

  l1.forEach(item=>{
    level1List.appendChild(makeQA(item,false));
  });

  l2.forEach(item=>{
    level2List.appendChild(makeQA(item,true));
  });
}

function renderTabs(){
  SECTIONS.forEach(title=>{
    const btn=document.createElement("button");
    btn.className="tab";
    btn.textContent="▸ "+title;
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".tab").forEach(b=>b.setAttribute("aria-selected","false"));
      btn.setAttribute("aria-selected","true");
      renderSection(title);
    });
    tabs.appendChild(btn);
  });
}

renderTabs();
</script>

</body>
</html>
