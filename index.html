<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ответы на часто задаваемые вопросы — Энергетический Тэттринг</title>
  <meta name="description" content="Ответы на часто задаваемые вопросы об Энергетическом Тэттринге. Вопросы сгруппированы по разделам. Углубляющие вопросы открываются после «Подробнее»." />

  <style>
    :root{
      color-scheme: light;

      --base: 17px;
      --h1: 32px;
      --h2: 22px;
      --w700: 700;

      --navy-1:#071a33;
      --navy-2:#0b2a52;

      --gold:#b68b2a;
      --gold-weak: rgba(182,139,42,0.12);
      --gold-border: rgba(182,139,42,0.45);

      --text:#0b1220;
      --muted:#5b6778;

      --bg:#ffffff;
      --surface:#ffffff;
      --surface-2:#f7f7f8;
      --border: rgba(16, 24, 40, 0.12);
      --shadow: 0 12px 28px rgba(2, 6, 23, 0.10);

      --r-lg: 18px;
      --r-md: 14px;

      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }

    *{ box-sizing: border-box; }

    body{
      margin:0;
      font-family: var(--font);
      font-size: var(--base);
      color: var(--text);
      background: var(--bg);
      line-height: 1.65;
    }

    /* Герой: более «резкий» и контрастный, без мутной дымки */
    .hero{
      color:#fff;
      padding: 34px 16px 22px;
      background:
        /* мелкие звёзды (чёткие точки) */
        radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,0.40) 0 1px, transparent 2px),
        radial-gradient(1px 1px at 28% 42%, rgba(255,255,255,0.30) 0 1px, transparent 2px),
        radial-gradient(1px 1px at 74% 28%, rgba(255,255,255,0.34) 0 1px, transparent 2px),
        radial-gradient(1px 1px at 86% 58%, rgba(255,255,255,0.26) 0 1px, transparent 2px),
        radial-gradient(1px 1px at 44% 70%, rgba(255,255,255,0.22) 0 1px, transparent 2px),
        radial-gradient(1px 1px at 62% 16%, rgba(255,255,255,0.18) 0 1px, transparent 2px),
        /* очень лёгкое золото, без больших «пятен» */
        radial-gradient(520px 320px at 78% 14%, rgba(182,139,42,0.10), transparent 60%),
        /* основной градиент */
        linear-gradient(180deg, var(--navy-1), var(--navy-2));
    }

    .wrap{
      max-width: 1020px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .hero h1{
      margin:0;
      font-size: var(--h1);
      font-weight: var(--w700);
      line-height: 1.12;
      letter-spacing: 0.2px;
      text-shadow: 0 2px 18px rgba(0,0,0,0.28); /* повышает читабельность без «мутности» */
    }

    .hero p{
      margin: 12px 0 0;
      max-width: 920px;
      color: rgba(255,255,255,0.90);
      font-size: 16px;
      text-shadow: 0 2px 14px rgba(0,0,0,0.22);
    }

    .content{
      padding: 22px 16px 60px;
    }

    /* Карточки-разделы */
    .tabs{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin: 0 0 16px;
    }

    @media (max-width: 720px){
      .tabs{ grid-template-columns: 1fr; }
    }

    .tab{
      appearance:none;
      border: 1px solid var(--gold-border);
      background: #fff;
      padding: 14px 14px;
      border-radius: 14px;
      cursor: pointer;
      text-align: left;
      box-shadow: 0 10px 20px rgba(2,6,23,0.06);
      transition: background 140ms ease, transform 20ms ease, box-shadow 140ms ease, border-color 140ms ease;
      color: var(--text);
    }

    .tab:hover{
      background: rgba(182,139,42,0.06);
      box-shadow: 0 12px 24px rgba(2,6,23,0.10);
    }

    .tab:active{ transform: translateY(1px); }

    .tab[aria-selected="true"]{
      background: rgba(182,139,42,0.10);
      border-color: rgba(182,139,42,0.72);
    }

    .tab-title{
      font-size: 16px;
      font-weight: var(--w700);
      line-height: 1.25;
      display: flex;
      gap: 8px;
      align-items: baseline;
    }

    .tab-title .ico{
      color: rgba(182,139,42,0.95);
      font-size: 14px;
      transform: translateY(-1px);
    }

    .tab-sub{
      margin-top: 6px;
      font-size: 13px;
      color: rgba(11,18,32,0.65);
      line-height: 1.35;
    }

    /* Панель вопросов */
    .panel{
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      background: var(--surface);
      box-shadow: var(--shadow);
      overflow: hidden;
      scroll-margin-top: 92px; /* ключ для мягкой прокрутки без ручных оффсетов */
    }

    .panel-head{
      padding: 18px 18px 14px;
      background: linear-gradient(180deg, #ffffff, #fbfbfc);
      border-bottom: 1px solid var(--border);
    }

    .panel-title{
      margin:0;
      font-size: var(--h2);
      font-weight: var(--w700);
      line-height: 1.25;
    }

    .panel-sub{
      margin:10px 0 0;
      color: var(--muted);
      font-size: 15px;
      max-width: 860px;
    }

    .block{
      padding: 18px 18px 10px;
    }

    details.qa{
      margin: 0 0 12px;
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      background: #fff;
      overflow: hidden;
    }

    details.qa summary{
      list-style:none;
      cursor:pointer;
      padding:14px 14px;
      font-size: 18px;
      font-weight: var(--w700);
      line-height: 1.25;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      user-select: none;
    }

    details.qa summary::-webkit-details-marker{ display:none; }

    .chev{
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      border: 1px solid var(--border);
      background: var(--surface-2);
      flex: 0 0 auto;
    }

    .chev svg{ transition: transform 160ms ease; }
    details.qa[open] .chev svg{ transform: rotate(180deg); }

    .qa-body{
      border-top:1px solid var(--border);
      padding:18px 20px 20px;
    }

    .answer, .more-body{
      max-width: 760px;
      line-height: 1.72;
    }

    .answer p, .more-body p{ margin: 0 0 16px; }
    .answer p:last-child, .more-body p:last-child{ margin-bottom: 0; }
    .answer ul, .more-body ul{ margin: 12px 0 16px 22px; padding: 0; }
    .answer li, .more-body li{ margin: 7px 0; }

    /* Подробнее */
    .more-wrap{
      margin-top:14px;
      border:1px dashed rgba(182,139,42,0.55);
      border-radius:14px;
      background:rgba(182,139,42,0.06);
      overflow:hidden;
      padding-top: 6px;
    }

    details.more summary{
      padding: 10px 12px 12px;
      cursor:pointer;
      user-select: none;
    }

    details.more summary::-webkit-details-marker{ display:none; }

    details.more summary::before{
      content:"Подробнее";
      background:var(--gold);
      color:#fff;
      padding:6px 12px;
      border-radius:10px;
      font-weight: 700;
      font-size: 13px;
    }

    .more-body{
      padding: 0 16px 16px;
    }

    /* Второй уровень (один раз в конце раздела) */
    .level2-block{
      margin: 18px 0 6px;
      padding: 16px 16px 6px;
      border-radius: 16px;
      background: rgba(74,108,255,0.07);
      border: 1px solid rgba(74,108,255,0.22);
    }

    .level2-block h4{
      margin: 0 0 12px;
      font-size: 15px;
      font-weight: var(--w700);
      color: #182235;
    }

    details.qa.level2-qa{
      background: rgba(255,255,255,0.96);
      border-color: rgba(74,108,255,0.22);
    }

    details.qa.level2-qa summary{
      font-size: 16.5px;
    }

    .hidden{ display:none; }

    .note{
      margin-top: 20px;
      padding: 18px 18px;
      border-radius: var(--r-lg);
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: var(--shadow);
    }

    .note h2{ margin: 0; font-size: 18px; font-weight: var(--w700); }
    .note p{ margin: 10px 0 0; color: var(--muted); font-size: 15px; }
  </style>
</head>

<body>
  <header class="hero">
    <div class="wrap">
      <h1>Ответы на часто задаваемые вопросы</h1>
      <p>Эти вопросы обычно появляются у людей, которые знакомятся с Энергетическим Тэттрингом и проверяют, как всё устроено: что является ядром, где границы, как устроена безопасность и что ожидать от практики.</p>
    </div>
  </header>

  <main class="content">
    <div class="wrap">
      <div class="tabs" id="tabs" role="tablist" aria-label="Разделы"></div>

      <section class="panel" aria-live="polite">
        <div class="panel-head">
          <h2 class="panel-title" id="panelTitle">Выберите раздел</h2>
          <p class="panel-sub" id="panelSub">Открыв раздел, вы увидите вопросы первого уровня. Углубляющие вопросы станут доступны после первого раскрытия «Подробнее» в этом разделе.</p>
        </div>

        <div class="block">
          <div id="level1List"></div>

          <div id="level2Block" class="level2-block hidden">
            <h4>Углубляющие вопросы раздела</h4>
            <div id="level2List"></div>
          </div>
        </div>
      </section>

      <section class="note">
        <h2>Границы и безопасность</h2>
        <p>Этот справочник не заменяет врача или психотерапию и не предназначен для кризисных ситуаций. Если вам плохо, тревожно, нестабильно, нарушается сон, нарастает страх или теряется контакт с реальностью, остановите любые практики и обратитесь за профессиональной помощью.</p>
      </section>
    </div>
  </main>

  <script type="module">
    import { FAQ } from "./faq-data.js";

    const SECTIONS = [
      "Что это за система и можно ли ей доверять",
      "Безопасность, границы и когда становится хуже",
      "Как это устроено на практике",
      "Что это даёт и чего не стоит ожидать",
      "Необычный опыт, инсайты и рациональный взгляд",
      "Для профессионалов и тех, кто уже многое пробовал"
    ];

    const panelTitle = document.getElementById("panelTitle");
    const panelSub = document.getElementById("panelSub");
    const tabs = document.getElementById("tabs");
    const level1List = document.getElementById("level1List");
    const level2Block = document.getElementById("level2Block");
    const level2List = document.getElementById("level2List");

    let level2Unlocked = false;

    function sectionIntro(title){
      const map = {
        "Что это за система и можно ли ей доверять": "Про ядро, границы, доверие и прозрачность.",
        "Безопасность, границы и когда становится хуже": "Про риски, перегруз, противопоказания и протоколы паузы.",
        "Как это устроено на практике": "Про форматы участия, выборочность, данные и выход/возврат.",
        "Что это даёт и чего не стоит ожидать": "Про ожидания, реальные изменения и критерии «это работает».",
        "Необычный опыт, инсайты и рациональный взгляд": "Про инсайты, символический язык и трезвость без мистификации.",
        "Для профессионалов и тех, кто уже многое пробовал": "Про этику, позиционирование, риски и интеграцию в практику."
      };
      return map[title] || "";
    }

    function parseQno(source_hint){
      const m = String(source_hint || "").match(/вопрос:\s*(\d+)/i);
      return m ? Number(m[1]) : null;
    }

    function groupFor(category, qno){
      const ranges = {
        "Что это за система и можно ли ей доверять":[9,13],
        "Безопасность, границы и когда становится хуже":[10,14],
        "Как это устроено на практике":[8,11],
        "Что это даёт и чего не стоит ожидать":[9,13],
        "Необычный опыт, инсайты и рациональный взгляд":[8,12],
        "Для профессионалов и тех, кто уже многое пробовал":[12,16]
      };
      if(!ranges[category]) return "L1";
      const [a,b]=ranges[category];
      if(qno>=a && qno<=b) return "L2";
      return "L1";
    }

    function normalizeAnswerText(t){
      return String(t || "").trim().replace(/\n{3,}/g, "\n\n");
    }

    function renderAnswer(container, text){
      container.innerHTML = "";
      const cleaned = normalizeAnswerText(text);
      if(!cleaned) return;

      const blocks = cleaned.split(/\n\s*\n/).map(x => x.trim()).filter(Boolean);

      for(const block of blocks){
        const lines = block.split("\n").map(x => x.trim()).filter(Boolean);
        const isList = lines.length >= 2 && lines.every(l => /^([—\-•])\s+/.test(l));

        if(isList){
          const ul = document.createElement("ul");
          for(const l of lines){
            const li = document.createElement("li");
            li.textContent = l.replace(/^([—\-•])\s+/, "");
            ul.appendChild(li);
          }
          container.appendChild(ul);
          continue;
        }

        const p = document.createElement("p");
        p.textContent = lines.join(" ");
        container.appendChild(p);
      }
    }

    function chevron(){
      const span = document.createElement("span");
      span.className = "chev";
      span.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
      return span;
    }

    function makeQA(item, isLevel2=false){
      const d = document.createElement("details");
      d.className = "qa" + (isLevel2 ? " level2-qa" : "");

      const s = document.createElement("summary");
      s.appendChild(document.createTextNode(item.question));
      s.appendChild(chevron());
      d.appendChild(s);

      const body = document.createElement("div");
      body.className = "qa-body";

      const ans = document.createElement("div");
      ans.className = "answer";
      renderAnswer(ans, item.answer_main);
      body.appendChild(ans);

      if(item.answer_more && !isLevel2){
        const moreWrap = document.createElement("div");
        moreWrap.className = "more-wrap";

        const more = document.createElement("details");
        more.className = "more";

        const ms = document.createElement("summary");
        more.appendChild(ms);

        const mb = document.createElement("div");
        mb.className = "more-body";
        renderAnswer(mb, item.answer_more);
        more.appendChild(mb);

        moreWrap.appendChild(more);
        body.appendChild(moreWrap);

        more.addEventListener("toggle", () => {
          if(more.open && !level2Unlocked){
            level2Unlocked = true;
            level2Block.classList.remove("hidden");
          }
        });
      }

      d.appendChild(body);
      return d;
    }

    function renderSection(section){
      level2Unlocked = false;
      level2Block.classList.add("hidden");
      level1List.innerHTML = "";
      level2List.innerHTML = "";

      panelTitle.textContent = section;
      panelSub.textContent = sectionIntro(section);

      const data = FAQ
        .filter(x => x.category === section)
        .map(x => ({...x, qno: parseQno(x.source_hint)}))
        .sort((a,b) => (a.qno ?? 1e9) - (b.qno ?? 1e9));

      const l1 = data.filter(x => groupFor(section, x.qno) === "L1");
      const l2 = data.filter(x => groupFor(section, x.qno) === "L2");

      for(const item of l1){
        level1List.appendChild(makeQA(item, false));
      }

      for(const item of l2){
        level2List.appendChild(makeQA(item, true));
      }
    }

    function smoothScrollToPanel(){
      const panel = document.querySelector(".panel");
      if(!panel) return;

      // Мягче на iOS: даём браузеру 1 кадр на отрисовку
      requestAnimationFrame(() => {
        panel.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }

    function renderTabs(){
      tabs.innerHTML = "";

      for(const title of SECTIONS){
        const btn = document.createElement("button");
        btn.className = "tab";
        btn.type = "button";
        btn.setAttribute("role", "tab");
        btn.setAttribute("aria-selected", "false");

        btn.innerHTML = `
          <div class="tab-title"><span class="ico">▸</span><span>${title}</span></div>
          <div class="tab-sub">${sectionIntro(title)}</div>
        `;

        btn.addEventListener("click", () => {
          document.querySelectorAll(".tab").forEach(b => b.setAttribute("aria-selected","false"));
          btn.setAttribute("aria-selected","true");
          renderSection(title);
          smoothScrollToPanel();
        });

        tabs.appendChild(btn);
      }
    }

    renderTabs();
  </script>
</body>
</html>
